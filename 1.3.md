---
marp: true
theme: default
header: "2024/8/2 MPC勉強会"
footer: "masaki fujiwara"
paginate: true
---
# PythonとCasADiで学ぶモデル予測制御
1.3以降

---
## 1.3.1 PID制御
---
## 1.3.1 PID制御

### PID制御
- **フィードバック制御**
- 現在最も広く普及している制御手法
- 我々も倒立振子の時など，お世話になってきた

---
## 1.3.1 PID制御
### 観測と状態変数の関係
制御対象のシステムからセンサを通じて直接取得できる量： $y(t)$
→つまり，観測

観測$y(t)$と状態変数$\mathbf{x}(t)$を完全に等しいと見なせば
$$
y(t) = \mathbf{x}(t)
$$
また，観測ノイズ$v(t)$が加わると
$$
y(t) = \mathbf{x}(t) + v(t)
$$
または，
$$
y(t) = g(\mathbf{x}(t))
$$

---
## 1.3.1 PID制御

### 誤差について
<!-- ![alt](images/image.png) -->

観測の目標値を$y_{ref}(t)$とする．
観測とその目標値との誤差を
$$
e(t) = y(t) - y_{ref}(t) \tag{1.13}
$$
とする．
この誤差$e(t)$を用いて，制御入力$u(t)$を次の式のように計算する．
$$
u(t) = K_{p}e(t) + K_{i}\int_{0}^{t}e(\tau)d\tau + K_{d}\dot{e}(t) \tag{1.14}
$$
---
## 1.3.1 PID制御

### 式$(1.14)$の各項とゲインについて

$$
\scriptsize u(t) = K_{p}e(t) + K_{i}\int_{0}^{t}e(\tau)d\tau + K_{d}\dot{e}(t) \tag{1.14}
$$

#### 第1項
$K_{p}e(t)$は誤差に比例しているため**比例項**と呼ばれる
#### 第2項
$K_{i}\int_{0}^{t}e(\tau)d\tau$は誤差の積分を利用していることから**積分項**と呼ばれる
#### 第3項
$K_{d}\dot{e}(t)$は誤差の微分を利用していることから**微分項**と呼ばれる．

---
## 1.3.1 PID制御
### PID制御の特徴
- 1入力1出力システムの場合，各項の影響を把握することは比較的簡単
（制御入力$u(t)$と観測$y(t)$がそれぞれ1次元であるシステム）

- 実際の制御対象を動作させながらPIDゲインを調整し，制御設計できる
（学部でやった倒立振子など）  

- 状態方程式モデルや伝達関数モデルを用意することなく使える

- 枯れた技術であるため，PID制御が今もなお採用され続けている

---
## 1.3.2 LQ制御
---
## 1.3.2 LQ制御

最適制御において最も基礎的な方法： **LQ(linear quadratic)制御**
離散時間で無限ホライズンの場合のLQ制御を説明する．
<br/>
状態方程式モデルとして，次の線形システムを考える．

$$
\mathbf{x}_{k+1} = A\mathbf{x}_{k} + B\mathbf{u}(k) \tag{1.15}
$$

<br/>

ここで，$A\in\mathbb{R}^{n_{x}\times n_{x}}$と$B\in\mathbb{R}^{n_{x}\times n_{u}}$は定数行列である．

---
## 1.3.2 LQ制御
評価関数として，次式を考える．
$$
\sum_{k=k_{s}}^\infty (\mathbf{x}^\mathrm{T}_{k}Q\mathbf{x}_{k} + \mathbf{u}^\mathrm{T}_{k}R\mathbf{u}_{k}) \tag{1.16}
$$

<br/>

ここで，$Q\in\mathbb{R}^{n_{x}\times n_{x}}$と$R\in\mathbb{R}^{n_{x}\times n_{u}}$は正定置行列である．
この行列は，状態変数$\mathbf{x}_{k}$と制御入力$\mathbf{u}_{k}$が0から離れていることに関するコストの
バランスを調整する行列である．

→無限の期間で$\mathbf{u}_{k}$を可能な限り小さく，$\mathbf{x}_{k}$を0に収束さたいという制御の目標を
定量化している

---
## 1.3.2 LQ制御

$$
\scriptsize \mathbf{x}_{k+1} = A\mathbf{x}_{k} + B\mathbf{u}(k) \tag{1.15}
$$

$$
\scriptsize \sum_{k=k_{s}}^\infty (\mathbf{x}^\mathrm{T}_{k}Q\mathbf{x}_{k} + \mathbf{u}^\mathrm{T}_{k}R\mathbf{u}_{k}) \tag{1.16}
$$

式$(1.15)$の$\mathbf{x}_{k}, \mathbf{u}_{k}$の挙動の望ましさを，式$(1.16)$の評価関数で定義する場合，
この評価関数を最小化する制御入力は次式のような制御則として与えられる．

$$
\mathbf{u}_{k} = - (R + B^\mathrm{T}PB)^{-1}B^\mathrm{T}PA\mathbf{x}_{k} \tag{1.17}
$$

<br/>

ここで，$R\in\mathbb{R}^{n_{x}\times n_{x}}$は次式（離散時間リッカチ方程式）を満たす行列である．

$$
P = A^\mathrm{T}PA - A^\mathrm{T}PB(R + B^\mathrm{T}PB)^{-1}B^\mathrm{T}PA + Q \tag{1.18}
$$

---
## 1.3.2 LQ制御
